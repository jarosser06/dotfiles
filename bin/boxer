#!/bin/bash

# Author: Jim Rosser
# This is my default command to help manage my workstation.
# This populates all of my custom dotfiles, installs a bunch of software
# etc ...

DOTFILES=${HOME}/.dotfiles
DOT_DIRECTORIES=".vim .bin .bash_custom"

function boxer_help {
  echo -e "\nboxer helps me keep track of my dotfiles, applications, etc"
  echo "boxer [command]"
  echo "  update - update workstation"
  echo "  install - same as update"
  echo "  reconfigure - kicks off the chef run"
}

function update_dotfiles {
  pushd $DOTFILES &> /dev/null
  git pull
  popd &> /dev/null
}

function create_dirs {
  DOT_DIRECTORIES=$DOT_DIRECTORIES:$(find ${DOTFILES}/files/* -type d)
  for dot_dir in $DOT_DIRECTORIES
  do
    if ! [ -d ${HOME}/${dot_dir} ]; then
      echo "${dot_dir} not found ... creating"
      mkdir -p ${HOME}/${dot_dir}
    fi
  done
}

function link_bin {
  pushd ${DOTFILES}/bin &> /dev/null
  for f in $(find . -not -type d)
  do
    echo "ln ${f} ${HOME}/${f}"
    #ln $f ${HOME}/.bin/${f}
  done
  popd &> /dev/null
}

function link_files {
  pushd ${DOTFILES}/files &> /dev/null
  dot_files=$(find . -not -type d)
  for f in $dot_files
  do
    echo "ln ${f} ${HOME}/${f}"
    #ln $f ${HOME}/${f}
  done
  popd &> /dev/null
}

function fetch_vundle {
  if ! [ -d ${HOME}/.vim/vundle.git ]; then
    git clone https://github.com/gmarik/Vundle.vim.git ${HOME}/.vim/vundle.git
  fi
}

function reconfigure {
  pushd /tmp &> /dev/null
  echo "cookbook_path \"${HOME}/.self_chef/cookbooks\"" > solo.rb
  sudo chef-solo -j ${HOME}/.self_chef/dna.json -c ./solo.rb
  popd &> /dev/null
}

case $1 in
  "update"|"install")
    #update_dotfiles
    create_dirs
    link_files
    fetch_vundle
    ;;
  "reconfigure")
    reconfigure
    ;;
  *)
    boxer_help
    ;;
esac
